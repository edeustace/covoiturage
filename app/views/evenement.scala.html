@import helper._ 
@import helper.twitterBootstrap._


@main(Messages("playauthenticate.event.title"),"event") {
  <link rel="stylesheet" media="screen" href="@routes.Assets.at("css/demo.css")" />
  <script src="http://maps.googleapis.com/maps/api/js?libraries=places&sensor=false&language=fr"></script>
  
  <script type="text/javascript" src="@routes.Assets.at("js/lib/angular.js")"></script>
  <script type="text/javascript" src="@routes.Assets.at("js/lib/ui-bootstrap-tpls-0.4.0.min.js")"></script>
  <script type="text/javascript" src="@routes.Assets.at("js/lib/event.js")"></script>
  <script type="text/javascript" src="@routes.Assets.at("js/lib/ui-map.js")"></script>
  <script type="text/javascript" src="@routes.Assets.at("js/app/modules/markerModule.js")"></script>
  <script type="text/javascript" src="@routes.Assets.at("js/app/event/app.js")"></script>
  <script type="text/javascript" src="@routes.Assets.at("js/app/directives/googleplace.js")"></script>
  <script type="text/javascript" src="@routes.Assets.at("js/app/event/controller.js")"></script>
  <script type="text/javascript" src="@routes.Assets.at("js/app/filters.js")"></script>
  <script type="text/javascript" src="@routes.Application.jsRoutes()"></script>
  <div ng-controller="EventCtrl" ng-app="covoiturage">

	<div class="row" >
		
		<div class="span6">
			<h1>
			{{event.name}}
			</h1>
			<p class="text-center">{{event.description}}</p>
			<strong>à l'adresse :</strong>
			<address>
			  {{event.address.description}}
			</address>
			<br/>
				<div ng-repeat="marker in myMarkers" ui-map-marker="myMarkers[$index]"
                     ui-event="{'map-click': 'openMarkerInfo(marker)'}">
                </div>
				<div ui-map-info-window="myInfoWindow">
						<strong>{{currentInfoWindowsSubscriber.surname}} {{currentInfoWindowsSubscriber.name}}</strong>
						<div ng-show="currentInfoWindowsSubscriber.locomotion == 'CAR'">
							Passagers : 
							<ul>
								<li ng-repeat="aPassenger in currentInfoWindowsSubscriber.car.passengers" >
									{{refSubscribers[aPassenger].surname}} {{refSubscribers[aPassenger].name}}
								</li>
							</ul>
							{{currentInfoWindowsSubscriber.car.nbPlaces - currentInfoWindowsSubscriber.car.passengers.length}} places restantes
						</div>
						<div ng-show="currentInfoWindowsSubscriber.locomotion == 'CAR' && currentSubscriber.locomotion == 'AUTOSTOP' && !currentInfoWindowsSubscriber.currentCar" >
							Monter 
							<button class="btn btn-success btn-mini" type="button" ng-click="addPassenger(currentInfoWindowsSubscriber, currentSubscriber)" >+</button>
						</div>
						<div ng-show="currentInfoWindowsSubscriber.locomotion == 'CAR' && currentSubscriber.locomotion == 'AUTOSTOP' && currentInfoWindowsSubscriber.currentCar">
							Descendre 
							<button class="btn btn-warning btn-mini" type="button" ng-click="removePassenger(currentInfoWindowsSubscriber, currentSubscriber)" >-</button>
						</div>
						<div ng-show="currentInfoWindowsSubscriber.locomotion == 'AUTOSTOP' && currentSubscriber.locomotion == 'CAR' && !currentInfoWindowsSubscriber.inMyCar">
							Prendre  
							<button class="btn btn-success btn-mini" type="button" ng-click="addPassenger(currentSubscriber, currentInfoWindowsSubscriber)" >+</button>
						</div>
						<div ng-show="currentInfoWindowsSubscriber.locomotion == 'AUTOSTOP' && currentSubscriber.locomotion == 'CAR' && currentInfoWindowsSubscriber.inMyCar">
							ne plus prendre 
							<button class="btn btn-warning btn-mini" type="button" ng-click="removePassenger(currentSubscriber, currentInfoWindowsSubscriber)" >-</button>
						</div>
                </div>
				<div id="map_canvas" ui-map="myMap" class="map"
	                 ui-options="mapOptions">
	            </div>
		</div>
		<div class="span4">
			<br/>
			
			
			<div>
				<h3>{{currentSubscriber.surname}} {{currentSubscriber.name}}</h3>
				<strong>Mon point de départ : </strong>
				<address ng-show="!editMode">
				  {{currentSubscriber.address.description}} <button class="btn" ng-show="!editMode" ng-click="setEditMode(true)">Modifier</button>
				</address>				
				<div ng-show="editMode" >
					<label>Nouvelle adresse : </label>
					<input ng-model="currentSubscriber.address" googleplace type="text" ></input>
					<button  class="btn btn-primary" ng-click="saveCurrentSubscriber()">Valider</button>
					<button  class="btn" ng-click="setEditMode(false)">Annuler</button>
				</div>
				<div ng-show="currentSubscriber.locomotion == 'CAR'">
					<label>Les passagers de ma voiture : </label>
					<ul>
						<li ng-repeat="passenger in currentSubscriber.car.passengers" >
							{{refSubscribers[passenger].surname}} {{refSubscribers[passenger].name}}
						</li>
					</ul>
					{{currentSubscriber.car.nbPlaces - currentSubscriber.car.passengers.length}} places restantes
				</div>
				<br/>
				<span>Je cherche une voiture</span>
				<input type="checkbox" ng:model="filterUsers" ng-true-value="CAR" ng-false-value=""/>
				<br/>								
				<span>Je cherche un passager</span>
				<input type="checkbox" ng:model="filterUsers"  ng-true-value="AUTOSTOP" ng-false-value=""/>
				<br/>
				
				
				<alert ng-repeat="alert in alerts" type="alert.type" close="closeAlert($index)">{{alert.msg}}</alert>
				<table id="searchTextResults" class="table">
					<thead>
						<tr>
							<th>locomotion</th>
							<th>Nom</th>
							<th>Adresse</th>
							<th>places restantes</th>
							<th ng-show="currentSubscriber.locomotion == 'AUTOSTOP'">Monter/Descendre</th>
							<th ng-show="currentSubscriber.locomotion == 'CAR'">Prendre/Ne plus prendre</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="subscriber in subscribers | auto:filterUsers:markers " ng-show="!subscriber.current" class="{{subscriber.class}}">
							<td><img ng-src="{{subscriber.picto}}" /></td>
							<td >{{subscriber.surname}} {{subscriber.name}}</td>
							<td>{{subscriber.address.description}}</td>
							<td>{{subscriber.car.nbPlaces - subscriber.car.passengers.length}}</td>
							<td ng-show="subscriber.locomotion == 'CAR' && currentSubscriber.locomotion == 'AUTOSTOP' && !subscriber.currentCar" >
								<button class="btn btn-success" type="button" ng-click="addPassenger(subscriber, currentSubscriber)" >+</button>
							</td>
							<td ng-show="subscriber.locomotion == 'CAR' && currentSubscriber.locomotion == 'AUTOSTOP' && subscriber.currentCar">
								<button class="btn btn-warning" type="button" ng-click="removePassenger(subscriber, currentSubscriber)" >-</button>
							</td>
							<td ng-show="subscriber.locomotion == 'AUTOSTOP' && currentSubscriber.locomotion == 'CAR' && !subscriber.inMyCar">
								<button class="btn btn-success" type="button" ng-click="addPassenger(currentSubscriber, subscriber)" >+</button>
							</td>
							<td ng-show="subscriber.locomotion == 'AUTOSTOP' && currentSubscriber.locomotion == 'CAR' && subscriber.inMyCar">
								<button class="btn btn-warning" type="button" ng-click="removePassenger(currentSubscriber, subscriber)" >-</button>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	</div>
}
