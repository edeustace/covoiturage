@import helper._ 
@import helper.twitterBootstrap._


@parentmain(Messages("playauthenticate.event.title"),"event") {
<link rel="stylesheet" media="screen" href="@routes.Assets.at("css/google-maps.css")" />
  <script src="http://maps.googleapis.com/maps/api/js?libraries=places&sensor=false&language=fr"></script>
  
  <script type="text/javascript" src="@routes.Assets.at("js/lib/angular.js")"></script>
  <script type="text/javascript" src="@routes.Assets.at("js/lib/ui-bootstrap-tpls-0.4.0.min.js")"></script>
  <script type="text/javascript" src="@routes.Assets.at("js/lib/angular-google-maps-2.js")"></script>
  <script type="text/javascript" src="@routes.Assets.at("js/app/modules/markerModule.js")"></script>
  <script type="text/javascript" src="@routes.Assets.at("js/app/event/app.js")"></script>
  <script type="text/javascript" src="@routes.Assets.at("js/app/directives/googleplace.js")"></script>
  <script type="text/javascript" src="@routes.Assets.at("js/app/event/controller.js")"></script>
  <script type="text/javascript" src="@routes.Assets.at("js/app/filters.js")"></script>
  <script type="text/javascript" src="@routes.Application.jsRoutes()"></script>
  <div ng-controller="EventCtrl" ng-app="covoiturage">

	<div class="row" >
		
		<div class="span6">
			<h1>
			{{event.name}}
			</h1>
			<p class="text-center">{{event.description}}</p>
			<strong>à l'adresse :</strong>
			<address>
			  {{event.address.description}}
			</address>
			<br/>
				<google-map center="center" fit="true" draggable="true" zoom="zoom" markers="markers" mark-click="true" style="height: 400px" class="angular-google-map" refresh="true"></google-map>
		</div>
		<div class="span4">
			<br/>
			
			
			<div>
				<h3>{{currentSubscriber.surname}} {{currentSubscriber.name}}</h3>
				<strong>Mon point de départ : </strong>
				<address ng-show="!editMode">
				  {{currentSubscriber.address.description}} <button class="btn" ng-show="!editMode" ng-click="setEditMode(true)">Modifier</button>
				</address>				
				<div ng-show="editMode" >
					<label>Nouvelle adresse : </label>
					<input ng-model="currentSubscriber.address" googleplace type="text" ></input>
					<button  class="btn btn-primary" ng-click="saveCurrentSubscriber()">Valider</button>
					<button  class="btn" ng-click="setEditMode(false)">Annuler</button>
				</div>
				<div ng-show="currentSubscriber.locomotion == 'CAR'">
					<label>Les passagers de ma voiture : </label>
					<ul>
						<li ng-repeat="passenger in currentSubscriber.car.passengers" >
							{{refSubscribers[passenger].surname}} {{refSubscribers[passenger].name}}
						</li>
					</ul>
				</div>
				<br/>
				<span>Je cherche une voiture</span>
				<input type="checkbox" ng:model="filterUsers" ng-true-value="CAR" ng-false-value=""/>
				<br/>								
				<span>Je cherche un passager</span>
				<input type="checkbox" ng:model="filterUsers"  ng-true-value="AUTOSTOP" ng-false-value=""/>
				<br/>
				
				
				<alert ng-repeat="alert in alerts" type="alert.type" close="closeAlert($index)">{{alert.msg}}</alert>
				<table id="searchTextResults" class="table">
					<thead>
						<tr>
							<th>Nom</th>
							<th>Prenom</th>
							<th>Adresse</th>
							<th>Type</th>
							<th>places restantes</th>
							<th ng-show="currentSubscriber.locomotion == 'AUTOSTOP'">Etre passager</th>
							<th ng-show="currentSubscriber.locomotion == 'AUTOSTOP'">Quitter cette voiture</th>
							<th ng-show="currentSubscriber.locomotion == 'CAR'">Ajouter à ma voiture</th>
							<th ng-show="currentSubscriber.locomotion == 'CAR'">Supprimer de ma voiture</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="subscriber in subscribers | auto:filterUsers:markers " ng-show="!subscriber.current" class="{{subscriber.class}}">
							<td >{{subscriber.name}}</td>
							<td>{{subscriber.surname}}</td>
							<td>{{subscriber.address.description}}</td>
							<td><img ng-src="{{subscriber.picto}}" /></td>
							<td>{{subscriber.car.nbPlaces - subscriber.car.passengers.length}}</td>
							<td ng-show="subscriber.locomotion == 'CAR' && currentSubscriber.locomotion == 'AUTOSTOP'" >
								<button class="btn btn-success" type="button" ng-click="addPassenger(subscriber, currentSubscriber)" >+</button>
							</td>
							<td ng-show="subscriber.locomotion == 'CAR' && currentSubscriber.locomotion == 'AUTOSTOP' && subscriber.currentCar">
								<button class="btn btn-warning" type="button" ng-click="removePassenger(subscriber, currentSubscriber)" >-</button>
							</td>
							<td ng-show="subscriber.locomotion == 'AUTOSTOP' && currentSubscriber.locomotion == 'CAR'">
								<button class="btn btn-success" type="button" ng-click="addPassenger(currentSubscriber, subscriber)" >+</button>
							</td>
							<td ng-show="subscriber.locomotion == 'AUTOSTOP' && currentSubscriber.locomotion == 'CAR' && subscriber.inMyCar">
								<button class="btn btn-warning" type="button" ng-click="removePassenger(currentSubscriber, subscriber)" >-</button>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	</div>
}
